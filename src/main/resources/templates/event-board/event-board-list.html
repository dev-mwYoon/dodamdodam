<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이벤트 정보 게시판 목록</title>
    <link rel="stylesheet" href="/css/event-board/event-info-board.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap"
          rel="stylesheet">
    <link rel="shortcut icon" href="/static/images/components/dodam-favicon.png">
</head>
<body>
<div id="root">
    <div id="root-inner">
        <!-- 본문 -->
        <div id="gaia">
            <div class="content">
                <p class="event">이벤트 정보</p>
                <div class="content-inner">
                    <!-- 모달창 -->
                    <div class="like-modal-container" id="like-modal" style="display:none;">
                        <span class="like-text" style="display:none;">찜 목록에 추가했습니다</span>
                        <span class="like-cancel-text" style="display:none;">찜 목록에서 제외했습니다</span>
                    </div>
                    <!-- 모달끝 -->
                    <div class="content-start">
                        <div class="content-title">
                            <div class="event-list">
                                <div class="event-list-title">이벤트 정보</div>
                                <div class="search-box">
                                    <div class="total-search">
                                        <div class="total-form">
                                            <div class="total-inner">
                                                <select>검색
                                                    <option value="제목+내용">제목+작성자</option>
                                                </select></div>
                                            <input aria-hidden="true" tabindex="-1" class="search-select" value="">
                                            <svg class="search-sign" focusable="false" aria-hidden="true"
                                                 viewBox="0 0 24 24">
                                                <path d="M7 10l5 5 5-5z"></path>
                                            </svg>
                                            <fieldset aria-hidden="true" class="total-input">
                                                <legend class="search-legend">
                                                    <span class="notranslate"></span>
                                                </legend>
                                            </fieldset>
                                        </div>
                                    </div><!-- total search -->

                                    <form class="input-keyword">
                                        <div class="form-border">
                                            <div class="form-input">
                                                <input placeholder="검색어를 입력해주세요" type="text" class="search-input">
                                            </div>
                                            <button class="search-button btn-search" type="button">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                                          d="M17.5198 16.7459C20.5958 13.2606 20.3576 7.96481 16.9811 4.76972C13.6045 1.57462 8.30367 1.62898 4.99337 4.89266C1.68307 8.15634 1.55352 13.4559 4.70041 16.8774C7.84729 20.2989 13.1392 20.6122 16.6678 17.5859L20.9638 21.8759L21.0058 21.9239L21.8518 21.0779L17.5198 16.7459ZM11.0698 3.59994C12.9233 3.59716 14.7106 4.28855 16.0798 5.53794C17.5393 6.86404 18.4042 8.7214 18.4798 10.6919C18.6153 13.6965 16.927 16.4867 14.2026 17.7608C11.4782 19.0349 8.25445 18.5419 6.03538 16.5117C3.8163 14.4816 3.03913 11.3144 4.06642 8.48763C5.09371 5.66089 7.72305 3.73165 10.7278 3.59994H11.0698Z"
                                                          fill="#60656A">
                                                    </path>
                                                </svg>
                                                <span class="search-span"></span>
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div><!-- search 끝 -->

                            <ul class="event-content">
<!--                                <li class="event-instance">-->
<!--                                    <div class="instance">-->
<!--                                        <img class="thumbnail"-->
<!--                                             src="https://static.makercenter.wadiz.kr/board/image/b5365bd3-c344-482b-b9f0-239f0185073a.jpg">-->
<!--                                        <button type="button" class="wish-button" aria-pressed="false">-->
<!--                                            <svg viewBox="0 0 32 32" focusable="false" role="presentation"-->
<!--                                                 class="wish-button-svg" aria-hidden="true">-->
<!--                                                <path d="M22.16 4h-.007a8.142 8.142 0 0 0-6.145 2.79A8.198 8.198 0 0 0 9.76 3.998a7.36 7.36 0 0 0-7.359 7.446c0 5.116 4.64 9.276 11.6 15.596l2 1.76 2-1.76c6.96-6.32 11.6-10.48 11.6-15.6v-.08A7.36 7.36 0 0 0 22.241 4h-.085z"></path>-->
<!--                                            </svg>-->
<!--                                        </button>-->
<!--                                        <div class="instance-detail">-->
<!--                                            <div class="detail-header">-->
<!--                                                <div class="detail-hedaer-left-center"></div>-->
<!--                                                <div class="detail-hedaer-right"><span>진행예정</span></div>-->
<!--                                            </div>-->

<!--                                            <div class="detail-title">[이벤트유형] 이벤트 제목입니다. 역삼역에서 진행되는 이벤트를 소개합니다.</div>-->
<!--                                            <div class="detail-writer">이벤트 게시자</div>-->
<!--                                            <div class="detail-date">2023.04.15</div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </li>-->
                            </ul>
                            <!-- 본문 내용 끝 -->
                            <!-- 하단 페이징 -->
                            <!--                        <div class="pageing">-->
                            <!--                            <div class="paging-content">-->
                            <!--                                <button class="page-btn" tabindex="-1" type="button" disabled>-->
                            <!--                                    <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 24L15 18L21 12" stroke="#868E96" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"></path></svg>-->
                            <!--                                </button>-->
                            <!--                                <span>-->
                            <!--                                    <button class="page-count btn">1</button>-->
                            <!--                                    <button class="page-count btn">2</button>-->
                            <!--                                    <button class="page-count btn">3</button>-->

                            <!--                                    <button class="page-count btn">4</button>-->
                            <!--                                    <button class="page-count btn">5</button>-->
                            <!--                                </span>-->
                            <!--                                <button class="page-btn" tabindex="0" type="button">-->
                            <!--                                    <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 12L21 18L15 24" stroke="#868E96" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"></path></svg>-->
                            <!--                                </button>-->
                            <!--                            </div>-->
                            <!--                        </div> &lt;!&ndash; 페이징 끝 &ndash;&gt;-->
                        </div>
                    </div> <!-- 본문, 페이징까지 끝 / content-start-->
                    <div class="footer-blank"></div>
                </div>
            </div>

            <!-- top 버튼 -->
            <div class="top-btn-container">
                <button type="button" class="top-btn">
                    <svg viewBox="0 0 40 40" focusable="false" role="presentation" class="top-btn-svg"
                         aria-hidden="true">
                        <path d="M33 30l-1.4 1.4L20 19.8 8.4 31.4 7 30l13-13zm1-21H6v2h28z"></path>
                    </svg>
                </button>
            </div>
            <div class="write-btn" onclick="location.href='/event/write-board-check'">
                <img src="/images/recruitment-board/write.png">
            </div>


        </div> <!-- gaia -->

    </div>
</div>
<!--모달창-->
<div id="myModal" class="modal" th:if="${#strings.equals(param.login, 'false')}">
    <div class="modal-content">
        <span class="close">&times;</span>
        <p>로그인 후 이용해주세요.</p>
        <button id="closeModalBtn">확인</button>
    </div>
</div>
</body>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    /* 상단 헤더 글쓰기 */
    const $exit = $("#apply_exit_btn")
    $(document).ready(function () {
        $('#apply-exit-btn').on("click", $exit, function () {
            $('#header-apply').css("display", "none");
        });
    });

    /* 좋아요 버튼 */
    $(function () {
        $('.wish-button').click(function (e) {
            var target = $(e.target);
            if ($(target).attr('aria-pressed') == 'false') {
                $(target).attr('aria-pressed', 'true') //하트 색 채우기
                $('.like-cancel-text').hide(); //해제 문구
                $('#like-modal').css({right: '-30%'}); //오->왼 슬라이드 등장
                $('#like-modal').animate({right: '30px'}, {duration: 700}); //오->왼 슬라이드 등장
                $('#like-modal').show(); //슬라이드 보이기
                $('.like-text').show(); //찜 추가 문구
                $('#like-modal').fadeOut(); //사라지기
            } else {
                $(target).attr('aria-pressed', 'false') //색 비우기
                $('.like-text').hide();  //찜 추가 문구
                $('#like-modal').css({right: '-30%'}); //오->왼 슬라이드 등장
                $('#like-modal').animate({right: '30px'}, {duration: 700}); //오->왼 슬라이드 등장
                $('#like-modal').show(); //슬라이드 보이기
                $('.like-cancel-text').show(); //찜 해제 문구
                $('#like-modal').fadeOut(); //사라지기
            }
        });
    });


    /* top 버튼  */
    var topEle = $('.top-btn');
    var delay = 400;

    /* top show-hide */
    $(window).scroll(function () {
        if ($(this).scrollTop() > 200) {
            $('.top-btn').fadeIn();
        } else {
            $('.top-btn').fadeOut();
        }
    });

    /* top버튼- 위로 올리기 */
    $('.top-btn').click(function () {
        $('html, body').animate({scrollTop: 0}, delay);
        return false;
    });

</script>
<script th:inline="javascript">
    let nextPage = 0;
    let checkStatus = false;

    $('.btn-search').on("click", function () {
        console.log("들어옴");
        $(".event-content").empty();
        nextPage = 0
        fetchData();
        checkStatus = false;
    });

    /* 날짜 변환 (년, 월, 일) */
    function changeDateToString(e) {
        let month = "";
        date = new Date(e.createdDate);
        month = date.getMonth() + 1;
        if (month < 10) {
            month = "0" + month;
        }
        return date.getFullYear() + "." + month + "." + date.getDate();
    }

    // ajax로 게시글 목록 불러오기(12개씩 가져옴)
    const fetchData = () => {
        let page = nextPage;
        let search = $('.search-input').val();  // searchbox안에 있는 value 값
        nextPage++;
        console.log("nextPage : " + nextPage);
        console.log("search : " + search);
        checkStatus = false;
        $.ajax({
            type: 'GET',
            url: `/event/list-search?page=${page}&&search=${search}`,
            success: function (result) {
                console.log(result);
                // showList(result); // 새로운 값을 담기
                setTimeout(function () {
                    checkStatus = true;
                }, 500);
                showList(result);

            },
            error: function (error) {
                console.log('Error fetching data:', error);
            }
        });
    };

    // 처음에 화면에 목록 뿌려주기
    $(document).ready(function () {
        console.log("Ready 들어옴");
        fetchData();
    });

    // 무한 스크롤 이벤트
    $(window).scroll(function () {
        if (Math.ceil($(window).scrollTop()) >= $(document).height() - $(window).height() - 50) {
            if (checkStatus) {
                fetchData();
            }
        }
    });

    // 화면에 데이터 받아온거 뿌려주기
    function showList(result) {
        // console.log("들어옴2@@@@@@@@@@@");
        console.log(result);
        for (let i = 0; i < result.length; i++) {
            let text = "";
            /* 날짜 변환해서 담아둠*/
            let date = new Date();
            /* 리스트 하나하나의 내용 */
            /* background-image 쪽 추가로 작업해야함, 밋밋하면 likeCount 추가 DTO에 만들어 둠 */
            if (result[i].eventFileDTOS.length != 0) {
                globalThis.filePath = '/file/display?fileName=' + result[i].eventFileDTOS[0].filePath + '/t_' + result[i].eventFileDTOS[0].fileUuid + '_' + result[i].eventFileDTOS[0].fileOriginalName;
            }

            let status;
            if (date < new Date(result[i].eventStartDate)) {
                status = "진행예정"; // Event not started yet
            } else if (date >= new Date(result[i].eventStartDate) && date <= new Date(result[i].eventEndDate)) {
                status = "진행중"; // Event is currently ongoing
            } else if(date <= new Date(result[i].eventEndDate)){
                status = "종료"; // Event has ended
            } else {
                status = "종료";
            }


            text += `
                    <div class="instance">
                        `;
            if (result[i].eventFileDTOS.length != 0) {
                text += `
                            <img class="thumbnail" src="${filePath}">
                        `;
            } else {
                text += `<img src="/images/free-board/basic-image.png">`;
            }
            text += `
                        <a href="/event/detail/${result[i].id}" style="text-decoration: none">
                        <div class="instance-detail">
                            <div class="detail-header">
                            <div class="detail-hedaer-left-center"></div>
                            <div class="detail-hedaer-right"><span>${status}</span></div>
                        </div>

                        <div class="detail-title">${result[i].boardTitle}</div>
                        <div class="detail-writer">${result[i].memberDTO.memberName}</div>
                        <div class="detail-date">${result[i].eventStartDate} ~ ${result[i].eventEndDate}</div>
                        </div>
                        </a>
                    </div>`;
            /* 추가한 내용 화면에 뿌려주기 */
            $(".event-content").append(text);
        }
    }


</script>
</html>

